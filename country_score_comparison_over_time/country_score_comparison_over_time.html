
<!DOCTYPE html>
<html>
<head>
<style type="text/css">
.inline {
  background-color: #f7f7f7;
  border:solid 1px #B0B0B0;
}
.error {
	font-weight: bold;
	color: #FF0000;
}
.warning {
	font-weight: bold;
}
.message {
	font-style: italic;
}
.source, .output, .warning, .error, .message {
	padding: 0 1em;
  border:solid 1px #F7F7F7;
}
.source {
  background-color: #f5f5f5;
}
.left {
  text-align: left;
}
.right {
  text-align: right;
}
.center {
  text-align: center;
}
.hl.num {
  color: #AF0F91;
}
.hl.str {
  color: #317ECC;
}
.hl.com {
  color: #AD95AF;
  font-style: italic;
}
.hl.opt {
  color: #000000;
}
.hl.std {
  color: #585858;
}
.hl.kwa {
  color: #295F94;
  font-weight: bold;
}
.hl.kwb {
  color: #B05A65;
}
.hl.kwc {
  color: #55aa55;
}
.hl.kwd {
  color: #BC5A65;
  font-weight: bold;
}
</style>
  <script src="https://yihui.name/media/js/center-images.js"></script>
  <title>A Report Generated by knitr</title>
</head>
<body>

  <p>This report is automatically generated with the R
    package <a href="https://yihui.name/knitr/"><strong>knitr</strong></a>
    (version <code class="knitr inline">1.31</code>)
    .</p>

<div class="chunk" id="auto-report"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl com">#!/usr/bin/env Rscript</span>

<span class="hl com">#### Country Score Comparison Over Time</span>
<span class="hl com">#Author: Katrina Norwood</span>
<span class="hl com">#Last Updated: 01/11/24</span>

<span class="hl com"># Script to plot the change in country antigenic scores over the three year period </span>
<span class="hl com"># of 01-2020 to 12-2023. The cumulative scores file contains countries and their </span>
<span class="hl com"># given antigenic score that eiher have 1% of that month's submitted isolates or </span>
<span class="hl com"># 500 sequences in that month. This was done so that the in the earlier months in </span>
<span class="hl com"># the pandemic, when there were fewer sequences, countries that were still sequencing</span>
<span class="hl com"># could be represented, despite not having 500 sequences. Please see the </span>
<span class="hl com"># country_frequency_threshold.py script to see how this was done.</span>

<span class="hl com"># To run:</span>
<span class="hl com"># 1. start in the /Corona_Variant_Scoring/ home directory</span>
<span class="hl com"># 2. in command line run: ```Rscript country_score_comparison_over_time/country_score_comparison_over_time.R```</span>

<span class="hl kwd">library</span><span class="hl std">(dplyr)</span>
</pre></div>
<div class="message"><pre class="knitr r">## 
## Attaching package: 'dplyr'
</pre></div>
<div class="message"><pre class="knitr r">## The following objects are masked from 'package:stats':
## 
##     filter, lag
</pre></div>
<div class="message"><pre class="knitr r">## The following objects are masked from 'package:base':
## 
##     intersect, setdiff, setequal, union
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">library</span><span class="hl std">(ggplot2)</span>

<span class="hl std">args</span> <span class="hl kwb">=</span> <span class="hl kwd">commandArgs</span><span class="hl std">(</span><span class="hl kwc">trailingOnly</span><span class="hl std">=</span><span class="hl num">TRUE</span><span class="hl std">)</span>
<span class="hl com">#output &lt;- args[1]</span>
<span class="hl com">#cumulative_scores &lt;- read.csv(args[2], sep = &quot;\t&quot;)</span>

<span class="hl std">output</span> <span class="hl kwb">&lt;-</span> <span class="hl str">&quot;country_score_comparison_over_time/&quot;</span>
<span class="hl std">cumulative_scores</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">read.csv</span><span class="hl std">(</span><span class="hl str">&quot;country_score_comparison_over_time/country_antigenic_score_with_threshold.tsv&quot;</span><span class="hl std">,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;\t&quot;</span><span class="hl std">)</span>
<span class="hl kwd">print</span><span class="hl std">(</span><span class="hl kwd">head</span><span class="hl std">(cumulative_scores))</span>
</pre></div>
<div class="output"><pre class="knitr r">##          Country num_isolates seq_frequency country_score    date
## 1            USA       190474    0.32282525      15.27511 07-2022
## 2          Japan        57502    0.09745738      15.24057 07-2022
## 3 United Kingdom        46473    0.07876486      15.17426 07-2022
## 4        Germany        34223    0.05800292      15.06202 07-2022
## 5         France        26577    0.04504408      15.09913 07-2022
## 6         Israel        22089    0.03743759      15.10537 07-2022
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">## Data Cleaning and Set up:</span>

<span class="hl com"># Calculating the zscore of each country per month (to identify significant countries)</span>
<span class="hl std">monthly_df_list</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">list</span><span class="hl std">()</span>

<span class="hl kwa">for</span> <span class="hl std">(month</span> <span class="hl kwa">in</span> <span class="hl kwd">unique</span><span class="hl std">(cumulative_scores</span><span class="hl opt">$</span><span class="hl std">date)) {</span>
  <span class="hl kwd">print</span><span class="hl std">(month)</span>
  <span class="hl com"># Separate by month</span>
  <span class="hl std">month_df</span> <span class="hl kwb">&lt;-</span> <span class="hl std">cumulative_scores[cumulative_scores</span><span class="hl opt">$</span><span class="hl std">date</span> <span class="hl opt">==</span> <span class="hl std">month, ]</span>
  <span class="hl com"># Calculate zscores</span>
  <span class="hl std">month_df</span><span class="hl opt">$</span><span class="hl std">zscore</span> <span class="hl kwb">&lt;-</span> <span class="hl std">(month_df</span><span class="hl opt">$</span><span class="hl std">country_score</span> <span class="hl opt">-</span> <span class="hl kwd">mean</span><span class="hl std">(month_df</span><span class="hl opt">$</span><span class="hl std">country_score))</span> <span class="hl opt">/</span> <span class="hl kwd">sd</span><span class="hl std">(month_df</span><span class="hl opt">$</span><span class="hl std">country_score)</span>
  <span class="hl kwd">print</span><span class="hl std">(</span><span class="hl kwd">head</span><span class="hl std">(month_df))</span>
  <span class="hl com"># Check output</span>
  <span class="hl kwd">print</span><span class="hl std">(</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;Number of rows: &quot;</span><span class="hl std">,</span> <span class="hl kwd">nrow</span><span class="hl std">(month_df)))</span>
  <span class="hl kwd">print</span><span class="hl std">(</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;Monthly SD: &quot;</span><span class="hl std">,</span> <span class="hl kwd">sd</span><span class="hl std">(month_df</span><span class="hl opt">$</span><span class="hl std">country_score)))</span>
  <span class="hl kwd">print</span><span class="hl std">(</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;Monthly Mean: &quot;</span><span class="hl std">,</span> <span class="hl kwd">mean</span><span class="hl std">(month_df</span><span class="hl opt">$</span><span class="hl std">country_score)))</span>
  <span class="hl com"># Add to list of DFs</span>
  <span class="hl std">monthly_df_list</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">append</span><span class="hl std">(monthly_df_list,</span> <span class="hl kwd">list</span><span class="hl std">(month_df))</span>
<span class="hl std">}</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] &quot;07-2022&quot;
##          Country num_isolates seq_frequency country_score    date      zscore
## 1            USA       190474    0.32282525      15.27511 07-2022  0.59419690
## 2          Japan        57502    0.09745738      15.24057 07-2022  0.48136406
## 3 United Kingdom        46473    0.07876486      15.17426 07-2022  0.26476407
## 4        Germany        34223    0.05800292      15.06202 07-2022 -0.10186570
## 5         France        26577    0.04504408      15.09913 07-2022  0.01937376
## 6         Israel        22089    0.03743759      15.10537 07-2022  0.03973142
## [1] &quot;Number of rows:  51&quot;
## [1] &quot;Monthly SD:  0.306135932413619&quot;
## [1] &quot;Monthly Mean:  15.0932027726067&quot;
## [1] &quot;01-2020&quot;
##      Country num_isolates seq_frequency country_score    date      zscore
## 52     China          448    0.51672434    0.05165442 01-2020 -0.63879552
## 53    France           94    0.10841984    0.57192675 01-2020  2.00384338
## 54       USA           71    0.08189158    0.19182299 01-2020  0.07316798
## 55 Hong Kong           59    0.06805075    0.03030053 01-2020 -0.74725914
## 56  Thailand           34    0.03921569    0.05575882 01-2020 -0.61794790
## 57   Lebanon           25    0.02883506    0.60349544 01-2020  2.16419143
## [1] &quot;Number of rows:  13&quot;
## [1] &quot;Monthly SD:  0.196876055064473&quot;
## [1] &quot;Monthly Mean:  0.177417965833731&quot;
## [1] &quot;01-2021&quot;
##           Country num_isolates seq_frequency country_score    date     zscore
## 65            USA        87880    0.32086811     0.8602757 01-2021 -1.0989149
## 66 United Kingdom        69572    0.25402181     3.1774332 01-2021  1.7258769
## 67        Denmark        14804    0.05405248     1.1607742 01-2021 -0.7325843
## 68         Canada        11116    0.04058682     1.0734365 01-2021 -0.8390556
## 69          Japan         8558    0.03124703     0.7043222 01-2021 -1.2890341
## 70    Switzerland         7634    0.02787332     1.4049522 01-2021 -0.4349127
## [1] &quot;Number of rows:  31&quot;
## [1] &quot;Monthly SD:  0.820293209440696&quot;
## [1] &quot;Monthly Mean:  1.76170811427347&quot;
## [1] &quot;01-2022&quot;
##            Country num_isolates seq_frequency country_score    date     zscore
## 96             USA       468308    0.34375897      15.39629 01-2022  0.9478558
## 97  United Kingdom       307126    0.22544419      15.54117 01-2022  1.0591462
## 98         Germany        66152    0.04855852      14.00937 01-2022 -0.1175318
## 99         Denmark        61573    0.04519733      14.46642 01-2022  0.2335587
## 100         France        49667    0.03645779      14.66223 01-2022  0.3839751
## 101          Japan        45698    0.03354437      16.72042 01-2022  1.9650133
## [1] &quot;Number of rows:  64&quot;
## [1] &quot;Monthly SD:  1.30180054976211&quot;
## [1] &quot;Monthly Mean:  14.1623696235068&quot;
## [1] &quot;01-2023&quot;
##            Country num_isolates seq_frequency country_score    date     zscore
## 160            USA        76739    0.31534156      17.92031 01-2023  0.3428018
## 161          Japan        26991    0.11091341      16.65938 01-2023 -1.2095808
## 162 United Kingdom        17082    0.07019462      18.37653 01-2023  0.9044754
## 163         Canada        15657    0.06433890      17.14939 01-2023 -0.6063093
## 164        Germany        14907    0.06125694      17.27670 01-2023 -0.4495663
## 165        Austria        10665    0.04382541      16.48595 01-2023 -1.4230968
## [1] &quot;Number of rows:  38&quot;
## [1] &quot;Monthly SD:  0.812252152382311&quot;
## [1] &quot;Monthly Mean:  17.6418637764167&quot;
## [1] &quot;02-2020&quot;
##            Country num_isolates seq_frequency country_score    date     zscore
## 198          China          545    0.27006938    0.07561003 02-2020 -0.5723087
## 199          Italy          203    0.10059465    0.19229040 02-2020  0.0468970
## 200 United Kingdom          174    0.08622398    0.15941211 02-2020 -0.1275833
## 201          Japan          159    0.07879088    0.05624786 02-2020 -0.6750609
## 202      Hong Kong          159    0.07879088    0.08128252 02-2020 -0.5422056
## 203            USA          148    0.07333994    0.10051400 02-2020 -0.4401470
## [1] &quot;Number of rows:  16&quot;
## [1] &quot;Monthly SD:  0.18843555079122&quot;
## [1] &quot;Monthly Mean:  0.183453333837751&quot;
## [1] &quot;02-2021&quot;
##            Country num_isolates seq_frequency country_score    date     zscore
## 214            USA        84578    0.28084821      1.287425 02-2021 -1.4127417
## 215 United Kingdom        61527    0.20430547      3.473627 02-2021  1.3452997
## 216        Germany        19065    0.06330690      2.250214 02-2021 -0.1981181
## 217         Sweden        18489    0.06139425      2.698408 02-2021  0.3673089
## 218         Canada        10770    0.03576267      2.010973 02-2021 -0.4999370
## 219        Denmark         9285    0.03083161      2.490408 02-2021  0.1049024
## [1] &quot;Number of rows:  39&quot;
## [1] &quot;Monthly SD:  0.792664816923849&quot;
## [1] &quot;Monthly Mean:  2.4072554381847&quot;
## [1] &quot;02-2022&quot;
##            Country num_isolates seq_frequency country_score    date     zscore
## 253 United Kingdom       274451    0.28965041      15.68152 02-2022  0.3825383
## 254            USA       229075    0.24176143      16.12038 02-2022  0.9376873
## 255        Germany        80521    0.08498034      15.54476 02-2022  0.2095382
## 256        Denmark        53932    0.05691881      14.51294 02-2022 -1.0956955
## 257         France        40090    0.04231023      15.52740 02-2022  0.1875829
## 258          India        21821    0.02302947      14.21488 02-2022 -1.4727346
## [1] &quot;Number of rows:  59&quot;
## [1] &quot;Monthly SD:  0.790523991414456&quot;
## [1] &quot;Monthly Mean:  15.3791134110993&quot;
## [1] &quot;02-2023&quot;
##            Country num_isolates seq_frequency country_score    date     zscore
## 312            USA        58107    0.31886277      18.87255 02-2023  0.5397019
## 313 United Kingdom        18567    0.10188661      19.24782 02-2023  1.0277340
## 314        Germany        14522    0.07968963      18.23031 02-2023 -0.2955143
## 315         Canada        11536    0.06330392      18.14986 02-2023 -0.4001365
## 316        Austria        11158    0.06122964      17.74846 02-2023 -0.9221543
## 317          Japan         9908    0.05437025      17.07914 02-2023 -1.7925802
## [1] &quot;Number of rows:  32&quot;
## [1] &quot;Monthly SD:  0.768947898052397&quot;
## [1] &quot;Monthly Mean:  18.4575442224558&quot;
## [1] &quot;03-2020&quot;
##            Country num_isolates seq_frequency country_score    date     zscore
## 344            USA        16100    0.26512095     0.2373398 03-2020 -0.4044740
## 345 United Kingdom        11798    0.19427932     0.2074242 03-2020 -0.7243564
## 346         Canada         3689    0.06074728     0.2595251 03-2020 -0.1672510
## 347          Spain         3483    0.05735505     0.2133033 03-2020 -0.6614919
## 348         France         3285    0.05409455     0.2908553 03-2020  0.1677577
## 349      Australia         2735    0.04503763     0.1817912 03-2020 -0.9984460
## [1] &quot;Number of rows:  20&quot;
## [1] &quot;Monthly SD:  0.0935206373961234&quot;
## [1] &quot;Monthly Mean:  0.275166477203902&quot;
## [1] &quot;03-2021&quot;
##            Country num_isolates seq_frequency country_score    date      zscore
## 364            USA       134402    0.29001826      2.352527 03-2021 -0.85106366
## 365 United Kingdom        73181    0.15791302      3.589514 03-2021  0.67703486
## 366        Germany        35047    0.07562588      3.235855 03-2021  0.24014588
## 367         Sweden        27949    0.06030952      3.477882 03-2021  0.53913151
## 368         Canada        21957    0.04737973      2.965888 03-2021 -0.09335495
## 369         France        18422    0.03975176      3.201859 03-2021  0.19814996
## [1] &quot;Number of rows:  44&quot;
## [1] &quot;Monthly SD:  0.809494098552713&quot;
## [1] &quot;Monthly Mean:  3.04145796221274&quot;
## [1] &quot;03-2022&quot;
##            Country num_isolates seq_frequency country_score    date     zscore
## 408 United Kingdom       310139    0.37733110      14.99596 03-2022 -0.1795516
## 409            USA        89154    0.10846935      15.67416 03-2022  1.1352940
## 410        Germany        87405    0.10634143      15.02489 03-2022 -0.1234762
## 411        Denmark        59299    0.07214622      14.66869 03-2022 -0.8140374
## 412         France        47352    0.05761089      14.91541 03-2022 -0.3357165
## 413         Canada        21036    0.02559348      15.67320 03-2022  1.1334213
## [1] &quot;Number of rows:  55&quot;
## [1] &quot;Monthly SD:  0.515801793817667&quot;
## [1] &quot;Monthly Mean:  15.0885743903749&quot;
## [1] &quot;03-2023&quot;
##            Country num_isolates seq_frequency country_score    date      zscore
## 463            USA        46646    0.26563328      19.19624 03-2023  0.38354142
## 464 United Kingdom        18709    0.10654146      19.51238 03-2023  0.84925652
## 465         Canada        11044    0.06289186      19.13066 03-2023  0.28693726
## 466        Germany        10242    0.05832474      18.92437 03-2023 -0.01696048
## 467        Austria         8776    0.04997637      18.19173 03-2023 -1.09622630
## 468    South Korea         7730    0.04401975      19.31127 03-2023  0.55299361
## [1] &quot;Number of rows:  39&quot;
## [1] &quot;Monthly SD:  0.678825719555203&quot;
## [1] &quot;Monthly Mean:  18.9358806572545&quot;
## [1] &quot;04-2020&quot;
##            Country num_isolates seq_frequency country_score    date      zscore
## 502 United Kingdom        18499    0.29713928     0.3157245 04-2020  0.31017323
## 503            USA        17208    0.27640265     0.3033034 04-2020 -0.04202725
## 504         Canada         4853    0.07795107     0.3321802 04-2020  0.77677671
## 505          Japan         3060    0.04915110     0.3402761 04-2020  1.00633587
## 506         France         2258    0.03626901     0.3280056 04-2020  0.65840453
## 507          Spain         1505    0.02417399     0.2891254 04-2020 -0.44404263
## [1] &quot;Number of rows:  15&quot;
## [1] &quot;Monthly SD:  0.0352671540496623&quot;
## [1] &quot;Monthly Mean:  0.304785542193765&quot;
## [1] &quot;04-2021&quot;
##            Country num_isolates seq_frequency country_score    date     zscore
## 517            USA       170341    0.35771796      3.232430 04-2021 -0.3826765
## 518        Germany        42557    0.08937016      3.599577 04-2021  0.2455277
## 519 United Kingdom        35770    0.07511739      3.563701 04-2021  0.1841421
## 520         Canada        28737    0.06034801      3.667513 04-2021  0.3617680
## 521          India        17962    0.03772040      1.934266 04-2021 -2.6038887
## 522          Japan        16354    0.03434358      3.130828 04-2021 -0.5565221
## [1] &quot;Number of rows:  43&quot;
## [1] &quot;Monthly SD:  0.584439378591131&quot;
## [1] &quot;Monthly Mean:  3.45608105295186&quot;
## [1] &quot;04-2022&quot;
##            Country num_isolates seq_frequency country_score    date       zscore
## 560            USA       140035    0.25686530      14.97855 04-2022  0.693083345
## 561 United Kingdom        86554    0.15876545      14.71806 04-2022 -0.002681512
## 562        Germany        58597    0.10748410      14.65209 04-2022 -0.178881203
## 563         France        38363    0.07036900      14.65114 04-2022 -0.181434083
## 564        Denmark        38111    0.06990676      14.61007 04-2022 -0.291110058
## 565          Japan        23524    0.04314992      15.59124 04-2022  2.329544447
## [1] &quot;Number of rows:  50&quot;
## [1] &quot;Monthly SD:  0.374396114497504&quot;
## [1] &quot;Monthly Mean:  14.7190642721567&quot;
## [1] &quot;04-2023&quot;
##            Country num_isolates seq_frequency country_score    date     zscore
## 610            USA        28800    0.23681095      19.31473 04-2023  0.1417703
## 611         Canada         8663    0.07123240      19.49523 04-2023  0.4717204
## 612    South Korea         7441    0.06118438      19.13828 04-2023 -0.1807753
## 613 United Kingdom         6929    0.05697441      19.55782 04-2023  0.5861440
## 614          India         6862    0.05642350      17.08356 04-2023 -3.9368213
## 615          Japan         6621    0.05444185      18.70708 04-2023 -0.9690234
## [1] &quot;Number of rows:  34&quot;
## [1] &quot;Monthly SD:  0.5470438674502&quot;
## [1] &quot;Monthly Mean:  19.2371759630367&quot;
## [1] &quot;05-2020&quot;
##                  Country num_isolates seq_frequency country_score    date     zscore
## 644                  USA        12394    0.37701527     0.3763917 05-2020  0.2083863
## 645       United Kingdom         6507    0.19793758     0.4110310 05-2020  1.2838535
## 646               Canada         2001    0.06086877     0.3785562 05-2020  0.2755905
## 647                India         1593    0.04845775     0.3098733 05-2020 -1.8568513
## 648 United Arab Emirates         1013    0.03081463     0.3384281 05-2020 -0.9702928
## 649               Brazil          680    0.02068504     0.3817682 05-2020  0.3753154
## [1] &quot;Number of rows:  11&quot;
## [1] &quot;Monthly SD:  0.0322085767282752&quot;
## [1] &quot;Monthly Mean:  0.369679858517701&quot;
## [1] &quot;05-2021&quot;
##            Country num_isolates seq_frequency country_score    date     zscore
## 655            USA        92557    0.25127733      3.518759 05-2021  0.1644249
## 656 United Kingdom        43140    0.11711814      2.761816 05-2021 -0.8863447
## 657        Germany        28939    0.07856472      3.602132 05-2021  0.2801618
## 658        Denmark        23307    0.06327475      3.660755 05-2021  0.3615404
## 659         Canada        19900    0.05402529      3.809741 05-2021  0.5683587
## 660          Japan        18101    0.04914130      3.506173 05-2021  0.1469537
## [1] &quot;Number of rows:  42&quot;
## [1] &quot;Monthly SD:  0.720370396106459&quot;
## [1] &quot;Monthly Mean:  3.40031213416811&quot;
## [1] &quot;05-2022&quot;
##            Country num_isolates seq_frequency country_score    date      zscore
## 697            USA       195427    0.40669984      15.29010 05-2022  1.13464184
## 698        Germany        39885    0.08300400      14.71544 05-2022 -0.31691710
## 699         France        30784    0.06406406      14.82317 05-2022 -0.04479939
## 700          Japan        23417    0.04873272      15.25204 05-2022  1.03849068
## 701 United Kingdom        22654    0.04714486      14.80421 05-2022 -0.09270217
## 702         Canada        16847    0.03506001      15.10875 05-2022  0.67655392
## [1] &quot;Number of rows:  49&quot;
## [1] &quot;Monthly SD:  0.395890874839599&quot;
## [1] &quot;Monthly Mean:  14.8409068525943&quot;
## [1] &quot;05-2023&quot;
##         Country num_isolates seq_frequency country_score    date      zscore
## 746         USA        19064    0.19797086      19.51620 05-2023 -0.02818977
## 747       China        11136    0.11564223      19.82590 05-2023  0.80246758
## 748 South Korea         7408    0.07692867      19.40665 05-2023 -0.32201726
## 749      Canada         6927    0.07193371      19.65176 05-2023  0.33539751
## 750   Australia         5960    0.06189186      19.42700 05-2023 -0.26745944
## 751       Spain         4370    0.04538044      19.68748 05-2023  0.43118677
## [1] &quot;Number of rows:  28&quot;
## [1] &quot;Monthly SD:  0.372837405108126&quot;
## [1] &quot;Monthly Mean:  19.5267148777244&quot;
## [1] &quot;06-2020&quot;
##            Country num_isolates seq_frequency country_score    date      zscore
## 774            USA        15904    0.43190397     0.3965197 06-2020 -0.30909892
## 775 United Kingdom         7123    0.19343888     0.4312576 06-2020  0.03783431
## 776        Germany         1928    0.05235858     0.3007724 06-2020 -1.26534361
## 777          India         1435    0.03897021     0.4377948 06-2020  0.10312284
## 778         Brazil         1167    0.03169215     0.3831117 06-2020 -0.44300689
## 779         Canada          884    0.02400673     0.4675281 06-2020  0.40007416
## [1] &quot;Number of rows:  10&quot;
## [1] &quot;Monthly SD:  0.100128473605336&quot;
## [1] &quot;Monthly Mean:  0.427469305543066&quot;
## [1] &quot;06-2021&quot;
##            Country num_isolates seq_frequency country_score    date     zscore
## 784 United Kingdom        97228    0.31852446      1.981411 06-2021 -1.3935067
## 785            USA        53426    0.17502662      2.992681 06-2021 -0.1820738
## 786         Brazil        13304    0.04358466      5.341499 06-2021  2.6316519
## 787         Canada        12636    0.04139626      3.288807 06-2021  0.1726655
## 788          India        10929    0.03580403      1.824565 06-2021 -1.5813977
## 789          Japan         9480    0.03105702      3.530805 06-2021  0.4625621
## [1] &quot;Number of rows:  45&quot;
## [1] &quot;Monthly SD:  0.834771545167111&quot;
## [1] &quot;Monthly Mean:  3.14467085213033&quot;
## [1] &quot;06-2022&quot;
##            Country num_isolates seq_frequency country_score    date      zscore
## 829            USA       178492    0.34043933      15.42466 06-2022  1.17352031
## 830        Germany        49793    0.09497062      15.02376 06-2022 -0.03828468
## 831 United Kingdom        41171    0.07852580      15.17239 06-2022  0.41100390
## 832         France        29674    0.05659748      15.06786 06-2022  0.09503691
## 833        Denmark        17779    0.03391004      15.12386 06-2022  0.26431207
## 834          Japan        17442    0.03326728      15.22702 06-2022  0.57613600
## [1] &quot;Number of rows:  50&quot;
## [1] &quot;Monthly SD:  0.330829159783705&quot;
## [1] &quot;Monthly Mean:  15.0364214559082&quot;
## [1] &quot;06-2023&quot;
##         Country num_isolates seq_frequency country_score    date      zscore
## 879         USA        11511    0.19799443      19.59756 06-2023 -0.12235245
## 880 South Korea         7160    0.12315525      19.61650 06-2023 -0.05662992
## 881       China         6459    0.11109773      20.10114 06-2023  1.62481907
## 882       Japan         5739    0.09871341      19.66579 06-2023  0.11435730
## 883      Canada         3447    0.05928997      19.74129 06-2023  0.37633300
## 884   Australia         3370    0.05796553      19.08298 06-2023 -1.90768903
## [1] &quot;Number of rows:  17&quot;
## [1] &quot;Monthly SD:  0.288224418021808&quot;
## [1] &quot;Monthly Mean:  19.6328252274483&quot;
## [1] &quot;07-2020&quot;
##            Country num_isolates seq_frequency country_score    date       zscore
## 896            USA        23640    0.48583994     0.4182536 07-2020 -0.315809870
## 897      Australia         7175    0.14745777     0.6843939 07-2020  2.337039652
## 898 United Kingdom         3012    0.06190143     0.4434281 07-2020 -0.064874588
## 899          Japan         2729    0.05608533     0.3069994 07-2020 -1.424776707
## 900   South Africa         1271    0.02612109     0.4031010 07-2020 -0.466849693
## 901         Brazil         1210    0.02486744     0.4492345 07-2020 -0.006996602
## [1] &quot;Number of rows:  9&quot;
## [1] &quot;Monthly SD:  0.100322421786705&quot;
## [1] &quot;Monthly Mean:  0.449936460134061&quot;
## [1] &quot;07-2021&quot;
##            Country num_isolates seq_frequency country_score    date      zscore
## 905            USA       192194    0.31978822      2.096220 07-2021 -0.38886091
## 906 United Kingdom       133182    0.22159919      2.008455 07-2021 -0.50620894
## 907         France        39994    0.06654531      1.874120 07-2021 -0.68582509
## 908          Japan        25206    0.04193982      2.871058 07-2021  0.64715662
## 909        Denmark        19952    0.03319778      1.905616 07-2021 -0.64371289
## 910          Spain        15294    0.02544742      2.324987 07-2021 -0.08298255
## [1] &quot;Number of rows:  57&quot;
## [1] &quot;Monthly SD:  0.74790074845728&quot;
## [1] &quot;Monthly Mean:  2.387049355002&quot;
## [1] &quot;07-2023&quot;
##            Country num_isolates seq_frequency country_score    date      zscore
## 962            USA        16521    0.31358072      19.82777 07-2023 -0.27530081
## 963          Japan         7400    0.14045744      19.96104 07-2023  0.06998856
## 964    South Korea         5971    0.11333397      19.80509 07-2023 -0.33405361
## 965          China         3925    0.07449938      20.51328 07-2023  1.50082130
## 966         Canada         2679    0.05084939      20.05018 07-2023  0.30094323
## 967 United Kingdom         2070    0.03929012      19.95047 07-2023  0.04260960
## [1] &quot;Number of rows:  10&quot;
## [1] &quot;Monthly SD:  0.385962665730564&quot;
## [1] &quot;Monthly Mean:  19.9340224131635&quot;
## [1] &quot;08-2020&quot;
##            Country num_isolates seq_frequency country_score    date        zscore
## 972            USA        15529    0.31513688     0.4602772 08-2020 -0.7907299314
## 973 United Kingdom         7171    0.14552428     0.5427963 08-2020 -0.0567581505
## 974      Australia         5656    0.11477971     0.6448842 08-2020  0.8512701203
## 975          Japan         4043    0.08204639     0.3394759 08-2020 -1.8652047058
## 976         France         1813    0.03679201     0.6692352 08-2020  1.0678616387
## 977        Denmark         1701    0.03451915     0.5492494 08-2020  0.0006397314
## [1] &quot;Number of rows:  13&quot;
## [1] &quot;Monthly SD:  0.112428165117672&quot;
## [1] &quot;Monthly Mean:  0.549177479441495&quot;
## [1] &quot;08-2021&quot;
##            Country num_isolates seq_frequency country_score    date     zscore
## 985            USA       330421    0.36258441      1.985876 08-2021 -0.3988086
## 986 United Kingdom       157052    0.17233955      2.122959 08-2021 -0.1145807
## 987          Japan        58921    0.06465641      2.511618 08-2021  0.6912633
## 988         Turkey        44802    0.04916306      1.771373 08-2021 -0.8435594
## 989         Canada        33863    0.03715925      2.381856 08-2021  0.4222146
## 990         France        32018    0.03513465      1.880080 08-2021 -0.6181666
## [1] &quot;Number of rows:  65&quot;
## [1] &quot;Monthly SD:  0.482299972949912&quot;
## [1] &quot;Monthly Mean:  2.17822140842633&quot;
## [1] &quot;08-2022&quot;
##             Country num_isolates seq_frequency country_score    date      zscore
## 1050            USA       149734    0.35028447      15.30124 08-2022  0.30444069
## 1051          Japan        38346    0.08970580      15.36123 08-2022  0.54272476
## 1052        Germany        22178    0.05188273      15.23239 08-2022  0.03099547
## 1053 United Kingdom        19360    0.04529036      15.28090 08-2022  0.22365350
## 1054         Canada        15982    0.03738794      15.29079 08-2022  0.26295636
## 1055        Austria        15661    0.03663700      13.64354 08-2022 -6.27966120
## [1] &quot;Number of rows:  55&quot;
## [1] &quot;Monthly SD:  0.251771990671896&quot;
## [1] &quot;Monthly Mean:  15.2245856644051&quot;
## [1] &quot;08-2023&quot;
##             Country num_isolates seq_frequency country_score    date      zscore
## 1105            USA        36049    0.40777567      20.06516 08-2023 -0.57428840
## 1106          Japan         8403    0.09505226      20.29715 08-2023  0.08368401
## 1107    South Korea         5223    0.05908104      20.05666 08-2023 -0.59839729
## 1108 United Kingdom         5017    0.05675083      20.23164 08-2023 -0.10212443
## 1109         Canada         4822    0.05454504      20.29486 08-2023  0.07720729
## 1110          China         4428    0.05008823      21.02366 08-2023  2.14428804
## [1] &quot;Number of rows:  22&quot;
## [1] &quot;Monthly SD:  0.352572674269564&quot;
## [1] &quot;Monthly Mean:  20.2676413014069&quot;
## [1] &quot;09-2020&quot;
##             Country num_isolates seq_frequency country_score    date     zscore
## 1127            USA        16647    0.30524231     0.4523509 09-2020 -0.8542216
## 1128 United Kingdom        16264    0.29821956     0.7239986 09-2020  0.3674387
## 1129         France         2472    0.04532703     0.7222628 09-2020  0.3596322
## 1130        Denmark         2269    0.04160478     0.6733248 09-2020  0.1395472
## 1131         Canada         2093    0.03837762     0.4219027 09-2020 -0.9911540
## 1132          Japan         1388    0.02545061     0.3466944 09-2020 -1.3293825
## [1] &quot;Number of rows:  14&quot;
## [1] &quot;Monthly SD:  0.2223594492437&quot;
## [1] &quot;Monthly Mean:  0.642295133592796&quot;
## [1] &quot;09-2021&quot;
##             Country num_isolates seq_frequency country_score    date     zscore
## 1141            USA       296157    0.39585402      1.962178 09-2021 -0.5134637
## 1142 United Kingdom       171644    0.22942550      2.207086 09-2021  0.3775942
## 1143        Germany        40982    0.05477800      2.017967 09-2021 -0.3104849
## 1144         Canada        21602    0.02887400      2.431404 09-2021  1.1937380
## 1145          Japan        18646    0.02492291      2.517079 09-2021  1.5054518
## 1146         Brazil        13527    0.01808067      1.960278 09-2021 -0.5203796
## [1] &quot;Number of rows:  58&quot;
## [1] &quot;Monthly SD:  0.274850711644562&quot;
## [1] &quot;Monthly Mean:  2.10330427699893&quot;
## [1] &quot;09-2022&quot;
##             Country num_isolates seq_frequency country_score    date      zscore
## 1199            USA       105161    0.31947128      15.44972 09-2022 -0.06565915
## 1200          Japan        24013    0.07294970      15.49698 09-2022  0.02878095
## 1201        Germany        23606    0.07171327      15.39794 09-2022 -0.16916419
## 1202 United Kingdom        16644    0.05056323      15.56522 09-2022  0.16517404
## 1203         Canada        15670    0.04760429      15.47393 09-2022 -0.01727681
## 1204        Denmark        15076    0.04579976      15.45585 09-2022 -0.05342274
## [1] &quot;Number of rows:  47&quot;
## [1] &quot;Monthly SD:  0.50034020390579&quot;
## [1] &quot;Monthly Mean:  15.4825767804025&quot;
## [1] &quot;09-2023&quot;
##             Country num_isolates seq_frequency country_score    date      zscore
## 1246            USA        33735    0.33637787      20.38375 09-2023 -0.84705098
## 1247         Canada        10129    0.10099812      20.69771 09-2023  0.06561650
## 1248 United Kingdom         7125    0.07104468      20.50762 09-2023 -0.48697748
## 1249         France         6647    0.06627846      20.65927 09-2023 -0.04611988
## 1250          Japan         6266    0.06247943      20.69904 09-2023  0.06948846
## 1251    South Korea         4430    0.04417234      20.92174 09-2023  0.71684277
## [1] &quot;Number of rows:  23&quot;
## [1] &quot;Monthly SD:  0.344004454873992&quot;
## [1] &quot;Monthly Mean:  20.6751403027159&quot;
## [1] &quot;10-2020&quot;
##             Country num_isolates seq_frequency country_score    date     zscore
## 1269 United Kingdom        31959    0.35415166     0.8850879 10-2020  0.4278323
## 1270            USA        26754    0.29647278     0.5041470 10-2020 -0.9546898
## 1271         Canada         3281    0.03635820     0.5297145 10-2020 -0.8618997
## 1272        Denmark         3263    0.03615873     0.8085027 10-2020  0.1498870
## 1273         France         3001    0.03325539     0.7229034 10-2020 -0.1607726
## 1274        Iceland         1977    0.02190800     0.7016656 10-2020 -0.2378495
## [1] &quot;Number of rows:  21&quot;
## [1] &quot;Monthly SD:  0.275540550039175&quot;
## [1] &quot;Monthly Mean:  0.767202801307787&quot;
## [1] &quot;10-2021&quot;
##             Country num_isolates seq_frequency country_score    date     zscore
## 1290            USA       250361    0.36144757      2.020432 10-2021 -0.9582262
## 1291 United Kingdom       180110    0.26002581      2.427409 10-2021  1.1841306
## 1292        Germany        31656    0.04570194      2.155091 10-2021 -0.2493733
## 1293        Denmark        24606    0.03552382      2.254914 10-2021  0.2761016
## 1294         France        19874    0.02869220      2.096523 10-2021 -0.5576800
## 1295         Canada        18356    0.02650066      2.339978 10-2021  0.7238834
## [1] &quot;Number of rows:  51&quot;
## [1] &quot;Monthly SD:  0.189967036024118&quot;
## [1] &quot;Monthly Mean:  2.20246362911441&quot;
## [1] &quot;10-2022&quot;
##             Country num_isolates seq_frequency country_score    date       zscore
## 1341            USA        77090    0.24859963      15.77330 10-2022 -0.242147008
## 1342 United Kingdom        25499    0.08222911      15.96153 10-2022 -0.001561082
## 1343        Germany        24679    0.07958478      15.55766 10-2022 -0.517766701
## 1344          Japan        20413    0.06582779      15.68977 10-2022 -0.348900175
## 1345         Canada        17762    0.05727885      15.67308 10-2022 -0.370242815
## 1346        Denmark        17011    0.05485703      15.70931 10-2022 -0.323930821
## [1] &quot;Number of rows:  47&quot;
## [1] &quot;Monthly SD:  0.782382699556194&quot;
## [1] &quot;Monthly Mean:  15.9627481120338&quot;
## [1] &quot;10-2023&quot;
##             Country num_isolates seq_frequency country_score    date      zscore
## 1388            USA        23066    0.24913054      20.79681 10-2023 -1.12881137
## 1389         Canada        12237    0.13216901      21.18869 10-2023  0.08310939
## 1390 United Kingdom         7695    0.08311192      20.93042 10-2023 -0.71560329
## 1391         France         5847    0.06315210      21.22868 10-2023  0.20679150
## 1392    South Korea         4094    0.04421835      21.57586 10-2023  1.28049167
## 1393          Spain         3321    0.03586935      21.33646 10-2023  0.54011385
## [1] &quot;Number of rows:  25&quot;
## [1] &quot;Monthly SD:  0.323353136884989&quot;
## [1] &quot;Monthly Mean:  21.1618117409479&quot;
## [1] &quot;11-2020&quot;
##             Country num_isolates seq_frequency country_score    date     zscore
## 1413            USA        38996    0.32452315     0.5487193 11-2020 -0.6048253
## 1414 United Kingdom        35160    0.29260011     1.1428056 11-2020  0.2934747
## 1415        Denmark         9595    0.07984921     0.8172928 11-2020 -0.1987234
## 1416         Canada         6391    0.05318565     0.5704482 11-2020 -0.5719697
## 1417    Switzerland         3830    0.03187311     0.7890894 11-2020 -0.2413689
## 1418          Japan         3632    0.03022536     0.5992262 11-2020 -0.5284554
## [1] &quot;Number of rows:  19&quot;
## [1] &quot;Monthly SD:  0.66134511050375&quot;
## [1] &quot;Monthly Mean:  0.948717540214683&quot;
## [1] &quot;11-2021&quot;
##             Country num_isolates seq_frequency country_score    date     zscore
## 1432            USA       265916    0.31030841      2.188371 11-2021 -0.2238336
## 1433 United Kingdom       238710    0.27856060      2.725463 11-2021  0.1321530
## 1434        Denmark        50464    0.05888853      2.354549 11-2021 -0.1136901
## 1435        Germany        47950    0.05595484      2.271372 11-2021 -0.1688200
## 1436         France        45392    0.05296981      2.281039 11-2021 -0.1624125
## 1437         Canada        23890    0.02787823      2.351972 11-2021 -0.1153978
## [1] &quot;Number of rows:  51&quot;
## [1] &quot;Monthly SD:  1.50874359909331&quot;
## [1] &quot;Monthly Mean:  2.5260781418403&quot;
## [1] &quot;11-2022&quot;
##             Country num_isolates seq_frequency country_score    date      zscore
## 1483            USA        94777    0.29623182      16.39429 11-2022 -0.39229872
## 1484          Japan        32716    0.10225603      16.07363 11-2022 -0.76186640
## 1485        Germany        19740    0.06169868      15.99890 11-2022 -0.84799903
## 1486 United Kingdom        13799    0.04312969      16.87056 11-2022  0.15661378
## 1487        Austria        13659    0.04269211      14.87123 11-2022 -2.14766873
## 1488        Denmark        13085    0.04089804      16.77022 11-2022  0.04096962
## [1] &quot;Number of rows:  49&quot;
## [1] &quot;Monthly SD:  0.867657966075865&quot;
## [1] &quot;Monthly Mean:  16.7346713325805&quot;
## [1] &quot;11-2023&quot;
##             Country num_isolates seq_frequency country_score    date       zscore
## 1532            USA        23104    0.26977418      21.31692 11-2023 -1.065915261
## 1533         Canada        12184    0.14226664      21.55047 11-2023 -0.601208793
## 1534         France         4793    0.05596553      22.54170 11-2023  1.371079767
## 1535         Sweden         4394    0.05130660      21.94059 11-2023  0.175023513
## 1536 United Kingdom         4304    0.05025572      21.92084 11-2023  0.135724989
## 1537    South Korea         4047    0.04725485      21.85627 11-2023  0.007250997
## [1] &quot;Number of rows:  26&quot;
## [1] &quot;Monthly SD:  0.502581397846418&quot;
## [1] &quot;Monthly Mean:  21.852625084687&quot;
## [1] &quot;12-2020&quot;
##             Country num_isolates seq_frequency country_score    date     zscore
## 1558            USA        55560    0.33497929     0.6588385 12-2020 -0.6536241
## 1559 United Kingdom        38985    0.23504621     2.1841937 12-2020  1.2520655
## 1560        Denmark        17030    0.10267634     0.8787272 12-2020 -0.3789080
## 1561         Canada         6475    0.03903871     0.8170858 12-2020 -0.4559191
## 1562    Switzerland         5615    0.03385365     0.9272931 12-2020 -0.3182326
## 1563          Japan         5429    0.03273223     0.6641789 12-2020 -0.6469521
## [1] &quot;Number of rows:  24&quot;
## [1] &quot;Monthly SD:  0.800421650141578&quot;
## [1] &quot;Monthly Mean:  1.18201337341596&quot;
## [1] &quot;12-2021&quot;
##             Country num_isolates seq_frequency country_score    date     zscore
## 1582            USA       370937    0.33401017      8.791229 12-2021  0.4620132
## 1583 United Kingdom       286803    0.25825172      9.185469 12-2021  0.5842726
## 1584        Germany        57378    0.05166601      5.016598 12-2021 -0.7085553
## 1585         France        52157    0.04696476      7.627977 12-2021  0.1012716
## 1586        Denmark        45202    0.04070213      6.004226 12-2021 -0.4022775
## 1587         Canada        35672    0.03212085     10.014627 12-2021  0.8414068
## [1] &quot;Number of rows:  61&quot;
## [1] &quot;Monthly SD:  3.22461353733874&quot;
## [1] &quot;Monthly Mean:  7.30141526865545&quot;
## [1] &quot;12-2022&quot;
##             Country num_isolates seq_frequency country_score    date     zscore
## 1643            USA       105159    0.29404084      16.96018 12-2022 -0.3063996
## 1644          Japan        41880    0.11710296      16.39711 12-2022 -0.9247611
## 1645 United Kingdom        28491    0.07966524      17.66368 12-2022  0.4661857
## 1646        Germany        18492    0.05170649      16.52253 12-2022 -0.7870213
## 1647         France        17428    0.04873138      16.70441 12-2022 -0.5872828
## 1648        Denmark        15875    0.04438896      17.39139 12-2022  0.1671494
## [1] &quot;Number of rows:  46&quot;
## [1] &quot;Monthly SD:  0.910586953247133&quot;
## [1] &quot;Monthly Mean:  17.2391821040722&quot;
## [1] &quot;12-2023&quot;
##             Country num_isolates seq_frequency country_score    date     zscore
## 1689            USA        15040    0.25953408      22.58599 12-2023 -0.9697198
## 1690         Canada         8740    0.15081967      22.62829 12-2023 -0.9011112
## 1691 United Kingdom         5838    0.10074202      23.43411 12-2023  0.4056861
## 1692         France         3833    0.06614323      23.59670 12-2023  0.6693671
## 1693        Denmark         3780    0.06522865      24.08550 12-2023  1.4620664
## 1694         Sweden         2065    0.03563417      23.36970 12-2023  0.3012377
## [1] &quot;Number of rows:  21&quot;
## [1] &quot;Monthly SD:  0.616630897493712&quot;
## [1] &quot;Monthly Mean:  23.1839475315185&quot;
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">cumulative_scores_zscores</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">do.call</span><span class="hl std">(rbind, monthly_df_list)</span>
<span class="hl kwd">print</span><span class="hl std">(</span><span class="hl kwd">head</span><span class="hl std">(cumulative_scores_zscores))</span>
</pre></div>
<div class="output"><pre class="knitr r">##          Country num_isolates seq_frequency country_score    date      zscore
## 1            USA       190474    0.32282525      15.27511 07-2022  0.59419690
## 2          Japan        57502    0.09745738      15.24057 07-2022  0.48136406
## 3 United Kingdom        46473    0.07876486      15.17426 07-2022  0.26476407
## 4        Germany        34223    0.05800292      15.06202 07-2022 -0.10186570
## 5         France        26577    0.04504408      15.09913 07-2022  0.01937376
## 6         Israel        22089    0.03743759      15.10537 07-2022  0.03973142
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">print</span><span class="hl std">(</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;Length of cumulative_scores_zscores: &quot;</span><span class="hl std">,</span> <span class="hl kwd">nrow</span><span class="hl std">(cumulative_scores_zscores)))</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] &quot;Length of cumulative_scores_zscores:  1709&quot;
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">print</span><span class="hl std">(</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;Length of cumulative_scores: &quot;</span><span class="hl std">,</span> <span class="hl kwd">nrow</span><span class="hl std">(cumulative_scores)))</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] &quot;Length of cumulative_scores:  1709&quot;
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># Creating a subplot with just a select number of countries</span>
<span class="hl std">selected_countries</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;USA&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;Germany&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;India&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;South Africa&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;Brazil&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;United Kingdom&quot;</span><span class="hl std">)</span>
<span class="hl std">cumulative_scores_countries_df</span> <span class="hl kwb">&lt;-</span> <span class="hl std">cumulative_scores_zscores[cumulative_scores_zscores</span><span class="hl opt">$</span><span class="hl std">Country</span> <span class="hl opt">%in%</span>
                                                      <span class="hl std">selected_countries, ]</span>
<span class="hl std">cumulative_scores_countries_df</span> <span class="hl kwb">&lt;-</span> <span class="hl std">cumulative_scores_countries_df</span> <span class="hl opt">%&gt;%</span>
  <span class="hl kwd">mutate</span><span class="hl std">(</span><span class="hl kwc">date</span> <span class="hl std">=</span> <span class="hl kwd">as.Date</span><span class="hl std">(</span><span class="hl kwd">paste0</span><span class="hl std">(</span><span class="hl str">&quot;01-&quot;</span><span class="hl std">, date),</span> <span class="hl kwc">format</span><span class="hl std">=</span><span class="hl str">&quot;%d-%m-%Y&quot;</span><span class="hl std">))</span> <span class="hl opt">%&gt;%</span>
  <span class="hl kwd">arrange</span><span class="hl std">(date)</span>
<span class="hl kwd">print</span><span class="hl std">(</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;cumulative_scores_countries_df nrows: &quot;</span><span class="hl std">,</span> <span class="hl kwd">nrow</span><span class="hl std">(cumulative_scores_countries_df)))</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] &quot;cumulative_scores_countries_df nrows:  252&quot;
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com"># Creating a subplot with all other countries in it (to be shown as grey in the plot)</span>
<span class="hl std">cumulative_scores_others_df</span> <span class="hl kwb">&lt;-</span> <span class="hl std">cumulative_scores_zscores[</span><span class="hl opt">!</span><span class="hl std">(cumulative_scores_zscores</span><span class="hl opt">$</span><span class="hl std">Country</span>  <span class="hl opt">%in%</span>
                                                   <span class="hl std">selected_countries), ]</span>
<span class="hl com"># Filtering out countries that have high sequencing for less than 30 months (to make plot cleaner)</span>
<span class="hl std">cumulative_scores_others_df_subset</span> <span class="hl kwb">&lt;-</span> <span class="hl std">cumulative_scores_others_df</span> <span class="hl opt">%&gt;%</span>
  <span class="hl kwd">group_by</span><span class="hl std">(Country)</span> <span class="hl opt">%&gt;%</span>
  <span class="hl kwd">filter</span><span class="hl std">(</span><span class="hl kwd">n</span><span class="hl std">()</span> <span class="hl opt">&gt;=</span> <span class="hl num">30</span><span class="hl std">)</span> <span class="hl opt">%&gt;%</span>
  <span class="hl kwd">mutate</span><span class="hl std">(</span><span class="hl kwc">date</span> <span class="hl std">=</span> <span class="hl kwd">as.Date</span><span class="hl std">(</span><span class="hl kwd">paste0</span><span class="hl std">(</span><span class="hl str">&quot;01-&quot;</span><span class="hl std">, date),</span> <span class="hl kwc">format</span><span class="hl std">=</span><span class="hl str">&quot;%d-%m-%Y&quot;</span><span class="hl std">))</span> <span class="hl opt">%&gt;%</span>
  <span class="hl kwd">arrange</span><span class="hl std">(date)</span>
<span class="hl kwd">print</span><span class="hl std">(</span><span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;cumulative_scores_others_df_subset nrows: &quot;</span><span class="hl std">,</span> <span class="hl kwd">nrow</span><span class="hl std">(cumulative_scores_others_df_subset)))</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] &quot;cumulative_scores_others_df_subset nrows:  813&quot;
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">sapply</span><span class="hl std">(cumulative_scores_countries_df, class)</span>
</pre></div>
<div class="output"><pre class="knitr r">##       Country  num_isolates seq_frequency country_score          date        zscore 
##   &quot;character&quot;     &quot;integer&quot;     &quot;numeric&quot;     &quot;numeric&quot;        &quot;Date&quot;     &quot;numeric&quot;
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">sapply</span><span class="hl std">(cumulative_scores_others_df_subset, class)</span>
</pre></div>
<div class="output"><pre class="knitr r">##       Country  num_isolates seq_frequency country_score          date        zscore 
##   &quot;character&quot;     &quot;integer&quot;     &quot;numeric&quot;     &quot;numeric&quot;        &quot;Date&quot;     &quot;numeric&quot;
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl com">## Plotting the results</span>

<span class="hl std">plt1</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">ggplot</span><span class="hl std">()</span> <span class="hl opt">+</span>
  <span class="hl kwd">geom_line</span><span class="hl std">(</span><span class="hl kwc">data</span> <span class="hl std">= cumulative_scores_others_df_subset,</span> <span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">x</span> <span class="hl std">= date,</span> <span class="hl kwc">y</span> <span class="hl std">= country_score,</span>
                                                           <span class="hl kwc">group</span> <span class="hl std">= Country,</span> <span class="hl kwc">color</span> <span class="hl std">=</span> <span class="hl str">&quot;Other&quot;</span><span class="hl std">))</span> <span class="hl opt">+</span>
  <span class="hl kwd">geom_line</span><span class="hl std">(</span><span class="hl kwc">data</span> <span class="hl std">= cumulative_scores_countries_df,</span> <span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">x</span> <span class="hl std">= date,</span> <span class="hl kwc">y</span> <span class="hl std">= country_score,</span>
                                                       <span class="hl kwc">group</span> <span class="hl std">= Country,</span> <span class="hl kwc">color</span> <span class="hl std">= Country))</span> <span class="hl opt">+</span>
  <span class="hl kwd">scale_x_date</span><span class="hl std">(</span><span class="hl kwc">date_breaks</span> <span class="hl std">=</span> <span class="hl str">&quot;2 months&quot;</span><span class="hl std">,</span> <span class="hl kwc">date_labels</span> <span class="hl std">=</span> <span class="hl str">&quot;%m-%Y&quot;</span><span class="hl std">,</span> <span class="hl kwc">expand</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl num">0</span><span class="hl std">))</span> <span class="hl opt">+</span>
  <span class="hl kwd">scale_color_manual</span><span class="hl std">(</span><span class="hl kwc">values</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;#000000&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;#E69F00&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;#56B4E9&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;grey&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;#F0E442&quot;</span><span class="hl std">,</span>
                                <span class="hl str">&quot;#0072B2&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;#009E73&quot;</span><span class="hl std">))</span> <span class="hl opt">+</span>
  <span class="hl kwd">labs</span><span class="hl std">(</span><span class="hl kwc">x</span> <span class="hl std">=</span> <span class="hl str">&quot;Month&quot;</span><span class="hl std">,</span> <span class="hl kwc">y</span> <span class="hl std">=</span> <span class="hl str">&quot;Country Antigenic Alteration Score&quot;</span><span class="hl std">,</span> <span class="hl kwc">color</span> <span class="hl std">=</span> <span class="hl kwa">NULL</span><span class="hl std">)</span> <span class="hl opt">+</span>
  <span class="hl kwd">theme_bw</span><span class="hl std">()</span> <span class="hl opt">+</span>
  <span class="hl kwd">theme</span><span class="hl std">(</span><span class="hl kwc">axis.text</span> <span class="hl std">=</span> <span class="hl kwd">element_text</span><span class="hl std">(</span><span class="hl kwc">size</span> <span class="hl std">=</span> <span class="hl num">7</span><span class="hl std">,</span> <span class="hl kwc">vjust</span> <span class="hl std">=</span> <span class="hl num">0.5</span><span class="hl std">,</span> <span class="hl kwc">hjust</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">),</span>
        <span class="hl kwc">axis.text.x</span> <span class="hl std">=</span> <span class="hl kwd">element_text</span><span class="hl std">(</span><span class="hl kwc">angle</span> <span class="hl std">=</span> <span class="hl num">45</span><span class="hl std">),</span>
        <span class="hl kwc">axis.title.x</span> <span class="hl std">=</span> <span class="hl kwd">element_text</span><span class="hl std">(</span><span class="hl kwc">size</span> <span class="hl std">=</span> <span class="hl num">8</span><span class="hl std">),</span>
        <span class="hl kwc">axis.title.y</span> <span class="hl std">=</span> <span class="hl kwd">element_text</span><span class="hl std">(</span><span class="hl kwc">size</span> <span class="hl std">=</span> <span class="hl num">8</span><span class="hl std">),</span>
        <span class="hl kwc">legend.title</span> <span class="hl std">=</span> <span class="hl kwd">element_text</span><span class="hl std">(</span><span class="hl kwc">size</span><span class="hl std">=</span><span class="hl num">10</span><span class="hl std">),</span>
        <span class="hl kwc">legend.text</span> <span class="hl std">=</span> <span class="hl kwd">element_text</span><span class="hl std">(</span><span class="hl kwc">size</span><span class="hl std">=</span><span class="hl num">8</span><span class="hl std">))</span>
<span class="hl std">plt1</span>
</pre></div>
</div><div class="rimage center"><img src="figure/country-score-comparison-over-time-Rhtmlauto-report-1.png" title="plot of chunk auto-report" alt="plot of chunk auto-report" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl kwd">ggsave</span><span class="hl std">(plt1,</span>
       <span class="hl kwc">filename</span> <span class="hl std">=</span> <span class="hl kwd">paste</span><span class="hl std">(output,</span> <span class="hl str">&quot;country_dynamics_ant_alt_scores_2020-01-2023-12_80x180.pdf&quot;</span><span class="hl std">,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;&quot;</span><span class="hl std">),</span>
       <span class="hl kwc">device</span> <span class="hl std">=</span> <span class="hl str">&quot;pdf&quot;</span><span class="hl std">,</span>
       <span class="hl kwc">height</span> <span class="hl std">=</span> <span class="hl num">60</span><span class="hl std">,</span> <span class="hl kwc">width</span> <span class="hl std">=</span> <span class="hl num">180</span><span class="hl std">,</span> <span class="hl kwc">units</span> <span class="hl std">=</span> <span class="hl str">&quot;mm&quot;</span><span class="hl std">)</span>

<span class="hl std">plt2</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">ggplot</span><span class="hl std">()</span> <span class="hl opt">+</span>
  <span class="hl kwd">geom_line</span><span class="hl std">(</span><span class="hl kwc">data</span> <span class="hl std">= cumulative_scores_others_df_subset,</span> <span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">x</span> <span class="hl std">= date,</span> <span class="hl kwc">y</span> <span class="hl std">= zscore,</span>
                                                           <span class="hl kwc">group</span> <span class="hl std">= Country,</span> <span class="hl kwc">color</span> <span class="hl std">=</span> <span class="hl str">&quot;Other&quot;</span><span class="hl std">))</span> <span class="hl opt">+</span>
  <span class="hl kwd">geom_line</span><span class="hl std">(</span><span class="hl kwc">data</span> <span class="hl std">= cumulative_scores_countries_df,</span> <span class="hl kwd">aes</span><span class="hl std">(</span><span class="hl kwc">x</span> <span class="hl std">= date,</span> <span class="hl kwc">y</span> <span class="hl std">= zscore,</span>
                                                       <span class="hl kwc">group</span> <span class="hl std">= Country,</span> <span class="hl kwc">color</span> <span class="hl std">= Country))</span> <span class="hl opt">+</span>
  <span class="hl kwd">scale_x_date</span><span class="hl std">(</span><span class="hl kwc">date_breaks</span> <span class="hl std">=</span> <span class="hl str">&quot;2 months&quot;</span><span class="hl std">,</span> <span class="hl kwc">date_labels</span> <span class="hl std">=</span> <span class="hl str">&quot;%m-%Y&quot;</span><span class="hl std">,</span> <span class="hl kwc">expand</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl num">0</span><span class="hl std">))</span> <span class="hl opt">+</span>
  <span class="hl kwd">scale_color_manual</span><span class="hl std">(</span><span class="hl kwc">values</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;#000000&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;#E69F00&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;#56B4E9&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;grey&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;#F0E442&quot;</span><span class="hl std">,</span>
                                <span class="hl str">&quot;#0072B2&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;#009E73&quot;</span><span class="hl std">))</span> <span class="hl opt">+</span>
  <span class="hl kwd">labs</span><span class="hl std">(</span><span class="hl kwc">x</span> <span class="hl std">=</span> <span class="hl str">&quot;Month&quot;</span><span class="hl std">,</span> <span class="hl kwc">y</span> <span class="hl std">=</span> <span class="hl str">&quot;Country Standardized Z-Score&quot;</span><span class="hl std">,</span> <span class="hl kwc">color</span> <span class="hl std">=</span> <span class="hl kwa">NULL</span><span class="hl std">)</span> <span class="hl opt">+</span>
  <span class="hl kwd">theme_bw</span><span class="hl std">()</span> <span class="hl opt">+</span>
  <span class="hl kwd">theme</span><span class="hl std">(</span><span class="hl kwc">axis.text</span> <span class="hl std">=</span> <span class="hl kwd">element_text</span><span class="hl std">(</span><span class="hl kwc">size</span> <span class="hl std">=</span> <span class="hl num">7</span><span class="hl std">,</span> <span class="hl kwc">vjust</span> <span class="hl std">=</span> <span class="hl num">0.5</span><span class="hl std">,</span> <span class="hl kwc">hjust</span> <span class="hl std">=</span> <span class="hl num">1</span><span class="hl std">),</span>
        <span class="hl kwc">axis.title.x</span><span class="hl std">=</span><span class="hl kwd">element_blank</span><span class="hl std">(),</span>
        <span class="hl kwc">axis.text.x</span> <span class="hl std">=</span> <span class="hl kwd">element_blank</span><span class="hl std">(),</span>
        <span class="hl kwc">axis.title.y</span> <span class="hl std">=</span> <span class="hl kwd">element_text</span><span class="hl std">(</span><span class="hl kwc">size</span> <span class="hl std">=</span> <span class="hl num">8</span><span class="hl std">),</span>
        <span class="hl kwc">legend.title</span> <span class="hl std">=</span> <span class="hl kwd">element_text</span><span class="hl std">(</span><span class="hl kwc">size</span><span class="hl std">=</span><span class="hl num">10</span><span class="hl std">),</span>
        <span class="hl kwc">legend.text</span> <span class="hl std">=</span> <span class="hl kwd">element_text</span><span class="hl std">(</span><span class="hl kwc">size</span><span class="hl std">=</span><span class="hl num">8</span><span class="hl std">))</span>
<span class="hl std">plt2</span>
</pre></div>
</div><div class="rimage center"><img src="figure/country-score-comparison-over-time-Rhtmlauto-report-2.png" title="plot of chunk auto-report" alt="plot of chunk auto-report" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl kwd">ggsave</span><span class="hl std">(plt2,</span>
       <span class="hl kwc">filename</span> <span class="hl std">=</span> <span class="hl kwd">paste</span><span class="hl std">(output,</span> <span class="hl str">&quot;country_dynamics_ant_alt_zscores_2020-01-2023-12_80x180.pdf&quot;</span><span class="hl std">,</span> <span class="hl kwc">sep</span> <span class="hl std">=</span> <span class="hl str">&quot;&quot;</span><span class="hl std">),</span>
       <span class="hl kwc">device</span> <span class="hl std">=</span> <span class="hl str">&quot;pdf&quot;</span><span class="hl std">,</span>
       <span class="hl kwc">height</span> <span class="hl std">=</span> <span class="hl num">50</span><span class="hl std">,</span> <span class="hl kwc">width</span> <span class="hl std">=</span> <span class="hl num">180</span><span class="hl std">,</span> <span class="hl kwc">units</span> <span class="hl std">=</span> <span class="hl str">&quot;mm&quot;</span><span class="hl std">)</span>

<span class="hl std">knitr</span><span class="hl opt">::</span><span class="hl kwd">knit_exit</span><span class="hl std">()</span>
</pre></div>
</div></div>
</body>
</html>



